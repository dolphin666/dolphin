<!doctype html>
<html>
 <head>
  <meta charset="UTF-8">
  <title>Document</title>
 </head>
 <body>
  <script>
		function conn(){
			console.log("连接数据库...");
			return new Promise((resolve,reject)=>{
				                //.then   .catch
				//3秒后自动调用callback
				setTimeout(()=>{
					var err=Math.random()<0.3?true:false;
					if(!err)
						resolve();//query->response
					else
					  reject("连接出错");//"出错啦"
					//(err)=>console.log(err);
				},3000);
			});
		}
		function query(){
			console.log("查询数据...");
			return new Promise((resolve,reject)=>{
				setTimeout(()=>{
					var err=Math.random()<0.3?true:false;
					if(!err)
						resolve();//response
					else
					  reject("查询出错");//"出错啦"
				},5000);
			});
		}
		function response(){
			console.log("返回响应...");
			return new Promise((resolve,reject)=>{
				setTimeout(()=>{
					var err=Math.random()<0.3?true:false;
					if(!err)
						resolve();//"成功"
					else
					  reject("响应出错");//"出错啦"
				},2000);
			})
		}
		//callback hell
//		conn(()=>
//			query(()=>
//				response(()=>console.log("查询出结果!"))
//			)
//		);
		conn()//Promise
			.then(()=>query())//Promise
			.then(()=>response())//Promise
			.then(()=>console.log("查询出结果"))
			.catch((err)=>console.log(err))
	</script>
 </body>
</html>
