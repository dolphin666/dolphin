<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
</head>
<body>
<select id="selProvince" onchange="loadCity(this.value)"></select>
<select id="selCity"></select>
<script src="common.js"></script>
<script>
	function loadProvince() {
		var xhr = getXhr();
		xhr.open("get", "3_province.php", false);
		xhr.onreadystatechange = function () {
			if (xhr.readyState == 4 && xhr.status == 200) {
				var tesText = xhr.responseText;
				var obj = JSON.parse(tesText);
				//console.log(obj);
				var opts = "";
				for (var i = 0; i < obj.length; i++) {
					opts += "<option>" + obj[i] + "</option>";
				}
				//console.log(opts);
				$("selProvince").innerHTML = opts;
			}
		}
		xhr.send(null);
	}
	function loadCity(p_value) {
		var xhr = getXhr();
		xhr.open("get", "3_city.php?pid=" + p_value, true);
		xhr.onreadystatechange = function () {
			if (xhr.readyState == 4 && xhr.status == 200) {
				console.log("OK");
				var array = JSON.parse(xhr.responseText);//TODO:错误待查
				console.log(array);
				var html = "";
				for (var i in array) {
					html += "<option value='" + i + "'>" + array[i] + "</option>";
				}
				$("selCity").innerHTML = html;
			}
		}
		xhr.send(null);
	}
	window.onload = function () {
		loadProvince();
		loadCity($("selProvince").value);
	}
</script>
</body>
</html>